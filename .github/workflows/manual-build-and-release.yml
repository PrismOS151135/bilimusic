name: Manual Build and Release

# 仅手动触发
on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'
      release_notes:
        description: 'Release notes'
        required: true
        default: 'Manual build and release'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:  # 新增：授予必要权限
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build with Gradle
      run: ./gradlew assembleRelease
      env:
        # 如果需要签名密钥，请在此添加Android signing配置
        # 示例：ANDROID_SIGNING_KEY_BASE64: ${{ secrets.ANDROID_SIGNING_KEY_BASE64 }}
        ANDROID_SIGNING_KEY_BASE64: "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"

    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.event.inputs.release_version }}
        release_name: Release ${{ github.event.inputs.release_version }}
        body: ${{ github.event.inputs.release_notes }}
        draft: false
        prerelease: false

    - name: Upload APK to Release
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./app/build/outputs/apk/release/app-release.apk
        asset_name: app-release-${{ github.event.inputs.release_version }}.apk
        asset_content_type: application/vnd.android.package-archive
